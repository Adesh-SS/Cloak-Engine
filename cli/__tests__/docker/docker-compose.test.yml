version: '3.8'

services:
  alpine-test:
    build:
      context: ../..
      dockerfile: cli/__tests__/docker/Dockerfile.test
    image: cloakscan-test:alpine
    volumes:
      - ../../cli:/workspace/cli:ro
      - test-data:/workspace/test-data
    environment:
      - CLOAKSCAN_HOME=/tmp/cloakscan
      - CLOAKSCAN_DEBUG=true
    working_dir: /workspace
    command: sh -c "cd cli && npm install && npm run build && node dist/index.js --version"

  debian-test:
    image: node:lts
    volumes:
      - ../../cli:/workspace/cli:ro
      - test-data:/workspace/test-data
    environment:
      - CLOAKSCAN_HOME=/tmp/cloakscan
      - CLOAKSCAN_DEBUG=true
    working_dir: /workspace
    command: sh -c "cd cli && npm install && npm run build && node dist/index.js --version"

volumes:
  test-data:

